<div id="pageTitle" class="editable" uuid="dc6c4fd5-9acf-4d93-9e3f-9439a95183f7">
 <h1>Database Versioning</h1>
 <h2></h2>
</div>
<div id="s1" class="editable section"><p>
	uSDLC uses a light-weight wrapper around JDBC to access SQL databases, mainly to add connection management and database version control.</p>
</div><div id="s4" class="editable section synopsis"><h2>
	<a class="usdlc sourceLink" href="DatabaseAccess.groovy" id="s4a6" action="runnable">Database Access</a></h2>
<p>
	Any class that is going to provide direct database access will save a static instance of <em>Database</em> with named parameters:</p>
<ul>
	<li>
		<strong>name</strong>: group of tables versioned together. Defaults to <strong>url</strong>.</li>
	<li>
		<strong>url</strong>: JDBC URL used to access the database. If it does not start with jdbc:, it is take as a H2 database name.</li>
	<li>
		<strong>version</strong>: Version of database expected by the software. Omit for unversioned access.</li>
</ul>
<p>
	The <em>connection</em> method will create a connection, commit on completion (rollback on exception) and release the connection to a pool for later use.</p>
<p>
	<em>Database</em> is a superclass of Groovy Sql. Refer to&nbsp;<a href="http://groovy.codehaus.org/api/groovy/sql/Sql.html" id="s4a7">http://groovy.codehaus.org/api/groovy/sql/Sql.html</a> for more details.</p>
</div><div id="s5" class="editable section synopsis"><h2>
	<a class="usdlc sourceLink" href="DatabaseVersioning.groovy" id="s5a6" action="runnable">Database Versioning</a></h2>
<p>
	uSDLC versioning is a system for keeping the database schema in sync with the software. If is available for any database engine for which uSDLC is given write access over JDBC. It will automatically run a groovy script for each version between that recorded in the database and that required by the software.</p>
<p>
	In this example we will cheat and remove the version table entry if it exists. We will then upgrade first to version 1 and then to version 3, running 3 upgrade scripts in total. Note that unlike live examples, the <em>Database</em>&nbsp;instances are not static so we can control when they occur.</p>
<p>
	Database scripts are always of the form <em>table_group_name_database_update_nnn.groovy</em> where nnn is the 3 digit version number. They can exist anywhere on or above the uSDLC home. The three upgrade scripts here are:</p>
<ul>
	<li>
		<a href="usdlc-database-test_database_update_001.groovy" id="s5a7" class="usdlc sourceLink" action="runnable">usdlc-database-test_database_update_001.groovy</a></li>
	<li>
		<a href="usdlc-database-test_database_update_002.groovy" id="s5a8" class="usdlc sourceLink" action="runnable">usdlc-database-test_database_update_002.groovy</a></li>
	<li>
		<a href="usdlc-database-test_database_update_003.groovy" id="s5a9" class="usdlc sourceLink" action="runnable">usdlc-database-test_database_update_003.groovy</a></li>
</ul>
</div>
<div id="s2" class="editable section footer synopsis">
 <div>
  <a class="usdlc" href="../" id="s2a3" action="page"> Parent</a> -
  <a class="usdlc" href="Setup.coffee" id="s2a1" action="runnable"> Setup</a> -
  <a class="usdlc" href="Cleanup.coffee" id="s2a2" action="runnable"> Cleanup</a>
 </div>
</div>
